# ì…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ğŸ’Œ
# build.gradle ìˆ˜ì • í›„ ìµœì‹  version ë¶€í„° ì ìš©í•˜ê² ìŠµë‹ˆë‹¤.

3. ìê²© ì¦ëª…ì„ ì €ì¥í•˜ëŠ” ìƒˆ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í• ê²ë‹ˆë‹¤. Record ê°œë…ì„ ì‚¬ìš©í•  ì˜ˆì •. domain íŒ¨í‚¤ì§€ ë‚´ì— AccountCredentials ë ˆì½”ë“œë¥¼ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.

  - Record ë°ì´í„°ë§Œ ë³´ê´€í•˜ëŠ” í´ë˜ìŠ¤ê°€ í•„ìš”í•  ë•Œ ë§ì€ ìƒìš©êµ¬ ì½”ë“œë¥¼ í”¼í•  ìˆ˜ ìˆëŠ” ë°©ì‹ìœ¼ë¡œ,
```java
package com.example.cardatabase.domain;

public record AccountCredentials(String username, String password) {}
```
  - ì´ìƒê³¼ ê°™ì´ ì‘ì„±í–ˆì„ ê²½ìš° username / passwordì— ëŒ€í•œ Getter / Setterë¥¼ ì•ˆì¨ë„ ë©ë‹ˆë‹¤.

# Java Record
- RecordëŠ” ë°ì´í„° ìš´ë°˜ì²´(Data Carrier) ì—­í• ì„ í•˜ëŠ”  í´ë˜ìŠ¤ë¥¼ ê°„ê²°í•˜ê²Œ ìƒì„±í•˜ê¸° ìœ„í•´ 14ì—ì„œ ë„ì…ë˜ì—ˆê³ , 16ì—ì„œ ì •ì‹ ê¸°ëŠ¥ì´ ëìŠµë‹ˆë‹¤. ì£¼ë¡œ DTO(Data Transfer Object)ë‚˜ POJO(Plain Old Java Object)ì™€ ê°™ì€ ë¶ˆë³€ ë°ì´í„° ê°ì²´ë¥¼ ë§Œë“¤ ë•Œ ë°œìƒí•˜ëŠ” ë°˜ë³µì ì¸ ìƒìš©êµ¬ ì½”ë“œ(boilerplate code) ì‘ì„±ì„ ì¤„ì´ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ ë°œëª…ë¨.

## Record íŠ¹ì§•
1. ê°„ê²°ì„±
  - fieldë§Œì„ ì •ì˜í•˜ë©´, ì»´íŒŒì¼ëŸ¬ê°€ í•„ìš”í•œ ë©”ì„œë“œë“¤ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
  - ì´ìƒì˜ ê²½ìš°ëŠ” usernameê³¼ passwordì— ëŒ€í•œ getter / setterë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•œë‹¤ê³  í–ˆìŠµë‹ˆë‹¤.
2. ë¶ˆë³€ì„±
  - ëª¨ë“  fieldëŠ” private finalë¡œ ì„ ì–¸ë©ë‹ˆë‹¤. -> privateì´ë‹ˆê¹Œ getter/setterë¡œ ê²½ìœ í•˜ì—¬ ê°’ì„ ë„£ì–´ì•¼ê² ë„¤ìš”.
3. ìë™ìƒì„±
  - ì´í•˜ì˜ ë©¤ë²„ë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
      1. AllArgsConstructor - () ë‚´ì— ì •ì˜ëœ ëª¨ë“  fieldë“¤ì„ ì‚¬ìš©í•˜ëŠ” ìƒì„±ìë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
      2. ì ‘ê·¼ì ë©”ì„œë“œ(Accessor Methods) : ì „í†µì ìœ¼ë¡œ íŠ¹ì • fieldì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì ‘ë‘ì‚¬ì¸ `get`ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  fieldëª…ì„ ê·¸ëŒ€ë¡œ ì”ë‹ˆë‹¤. person.getName()ê³¼ ê°™ì´ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ person.name
4. ì œì•½ì‚¬í•­
  - ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì„ ìˆ˜ ì—†ìŒ.
  - ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ fieldë¥¼ ì„ ì–¸í•  ìˆ˜ ì—†ìœ¼ë©°, ë ˆì½”ë“œ headerì— ì •ì˜ëœ fieldë“¤ ì™¸ì˜ fieldëŠ” staticì´ì–´ì•¼ë§Œ í•¨.
```java
public record Person(String name, int age) {
  // getter / setterëŠ” ì•Œì•„ì„œ ë§Œë“¤ì–´ì§€ê¸° ë•Œë¬¸ì— Lombok ë„ì… ë“±ì´ ë¶ˆí•„ìš”
  // ê°ì²´ ìƒì„± ì‹œì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•˜ì—¬ ìƒì„±ìë¥¼ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  public Person {
    if (age < 0) {
      throw new IllegalArgumentException("ë¶ˆê°€ëŠ¥í•œ ë‚˜ì´ ì…ë ¥ì…ë‹ˆë‹¤.");
    }
  }
}

public class PersonMain {
  public static void main(String[] args) {
    // Recordë¥¼ í†µí•œ ê°ì²´ ìƒì„± ë° ì‚¬ìš© ë°©ë²• ì˜ˆì‹œë“¤ì„ ì‘ì„±í•©ë‹ˆë‹¤.
    Person person1 = new Person("ê¹€ì¼", 21);  // AllArgsConstructorê°€ ê¸°ë³¸ìƒì„±ì´ê¸° ë•Œë¬¸ì— ì–˜ë¡œë§Œ ê°ì²´ ìƒì„± ê°€ëŠ¥
    String name = person1.name();
    System.out.printlin(name + " í•™ìƒì€ " + person1.age() + " ì‚´ì…ë‹ˆë‹¤.");
    System.out.printlin(person1.toString());    // ì›ë˜ toString()ì€ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šê³  ê°ì²´ëª…ë§Œìœ¼ë¡œ ë½‘ì•„ë‚¼ ìˆ˜ ìˆì—ˆì§€ë§Œ ë­ ì´ëŸ°ì‹ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. Person[name=ê¹€ì¼, age=21]
  }
}
```
# Java Optional
`java.util.Optional<T>` í´ë˜ìŠ¤ëŠ” Java 8ì—ì„œ ë„ì…ë˜ì—ˆê³ , _ê°’ì´ ìˆì„ ìˆ˜ë„ ìˆê³ , ì—†ì„ ìˆ˜ë„ ìˆëŠ”(present or absent)_ ì»¨í…Œì´ë„ˆ ê°ì²´. ì£¼ìš” ëª©ì ì€ null ê°’ì„ ì§ì ‘ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ì—¬, í”„ë¡œê·¸ë˜ë¨¸ì˜ ì‹¤ìˆ˜ë¥¼ ì¤„ì´ê³  í”íˆ ë°œìƒí•˜ëŠ” `NullPonterException` ì˜ˆì™¸ë¥¼ ë°©ì§€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## Optional íŠ¹ì§•
1. NPE ë°©ì§€
  - ë©”ì„œë“œì˜ return ê°’ì´ nullì´ ë  ê°€ëŠ¥ì„±ì´ ìˆì„ ë•Œ(findByUsername(username)ì˜ ê²°ê³¼ê°’ì´ nullì¼ ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼), Optionalì„ ë„ì…í•˜ë©´ í˜¸ì¶œìëŠ” ëª…ì‹œì ìœ¼ë¡œ ê°’ì´ ì—†ì„ ë•Œì˜ ìƒí™©ì„ ì²˜ë¦¬í•˜ë„ë¡ ê°•ì œë©ë‹ˆë‹¤(ë¹¼ë¨¹ê³  ì§€ë‚˜ê°ˆ ìˆ˜ ì—†ìœ¼ë‹ˆê¹Œ ì˜¤ë¥˜ ë°œìƒ ì•ˆí•˜ê² ì£ ).
2. í•¨ìˆ˜í˜• ìŠ¤íƒ€ì¼
  - map(), filter(), ifPresent() ë“±ì˜ ë©”ì„œë“œë¥¼ ì œê³µí•˜ê³  í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° ìŠ¤íƒ€ì¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. ì˜ë„ ë…¸ì¶œ
  - Optionalì„ ë„ì…í•œë‹¤ëŠ” ê²ƒë§Œìœ¼ë¡œë„ íŠ¹ì • ë©”ì„œë“œì˜ returnê°’ì´ nullì´ ë  ìˆ˜ ìˆìŒì„ ë‹¤ë¥¸ ê°œë°œìë“¤ì´ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Optional ê°ì²´ ìƒì„± ë° ì‚¬ìš© ë°©ë²•
1. Optional.of(T value)
  - nullì´ ì•„ë‹Œ ê°’ìœ¼ë¡œ Optionalì„ ìƒì„±. ë§Œì•½ ì´ ë©”ì„œë“œì˜ í˜¸ì¶œë¡œ valueì— null ë„£ìœ¼ë©´ NullPointerException ë°œìƒí•¨.
2. Optional.ofNullable(T value)
  - valueê°€ nullì¼ ìˆ˜ë„ ìˆëŠ” ê°’ìœ¼ë¡œ Optional ìƒì„±. nullì´ë©´ Optional.empty()ë¥¼ return
3. Optional.empty()
  - ê°’ì´ ì—†ëŠ” ë¹„ì–´ìˆëŠ” Optional ê°ì²´ë¥¼ return.

### ë°ì´í„° ì²˜ë¦¬ ë©”ì„œë“œ(NPE ë°©ì§€ ë° ëŒ€ì²´)
1. isPresent()
  - ê°’ì´ ì¡´ì¬í•˜ë©´ true ë°˜í™˜
2. get()
  - ê°’ì„ ë°˜í™˜. ê°’ì´ ì—†ìœ¼ë©´ NoSuchElementExceptionì„ ë°œìƒì‹œí‚¤ë¯€ë¡œ, isPresent()ë¡œ í™•ì¸ í›„ ì‚¬ìš©í•˜ê±°ë‚˜ ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
  - ì €í¬ ìˆ˜ì—… ìƒí™©ì—ì„œì˜ ì˜ˆì‹œ
```java
@Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        Optional<AppUser> user = userRepository.findByUsername(username);

        UserBuilder builder = null;
        if (user.isPresent()) { // ì´í•˜ì˜ ì‹¤í–‰ë¬¸ì´ ì‹¤í–‰ëœë‹¤ë©´ userì— AppUser ê°ì²´ê°€ ìˆë‹¤ëŠ” ì˜ë¯¸   // ì´ ë¶€ë¶„ì—ì„œ Optionalì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
            AppUser currentUser = user.get();                                                     // ì—¬ê¸°ì„œë„ ì¼ì£ . ê°ê° 1, 2 ë²ˆ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•¨.
            builder = User.withUsername(username);
            builder.password(currentUser.getPassword());
            builder.roles(currentUser.getRole());
        } else {
            throw new UsernameNotFoundException("User not found.");
        }

        return builder.build();
```
3. orElse(T other)
  - ê°’ì´ ì¡´ì¬í•˜ë©´ ê·¸ ê°’ì„ ë°˜í™˜í•˜ê³ , ê°’ì´ ì—†ìœ¼ë©´ `other`ë¡œ ì „ë‹¬ëœ ê¸°ë³¸ ê°’ì„ return
4. orElseGet(Supplier<? extends T> other)
  - ê°’ì´ ì¡´ì¬í•˜ë©´ ê·¸ ê°’ì„ ë°˜í™˜í•˜ê³ , ê°’ì´ ì—†ìœ¼ë©´ `other`(ëŒë‹¤ì‹)ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜(orElseì™€ ë‹¬ë¦¬ ê°’ì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ ëŒë‹¤ì‹ì´ í˜¸ì¶œë¨).
5. ifPresent(Consumer<? super T> action)
  - ê°’ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ `action`(ëŒë‹¤ì‹)ì„ ì‹¤í–‰

## Optional ì‚¬ìš© ì˜ˆì‹œ
```java
public class Example1 {
  public static void main(String[] args) {
    Optional<String> maybeName = Optional.ofNullable(findByUsername(username)); // ê°’ì´ nullì¼ ìˆ˜ë„ ìˆìŒ

    // 1. ê°’ì´ ìˆì„ ë•Œë§Œ ì‘ì—… ìˆ˜í–‰í•˜ëŠ” .ifPresent() - ëŒë‹¤ì‹ ì ìš©
    maybeName.ifPresent(name -> System.out.println("ì‚¬ìš©ì ì´ë¦„ : " + name));

    // 2. ê°’ì´ ì—†ì„ ë•Œ ê¸°ë³¸ ê°’ ì œê³µ
    String name = maybeName.orElse("Guest");    // ê°’ì´ ì—†ìœ¼ë©´ "Guest"ë¥¼ return
    System.out.printlin("ì‚¬ìš©ì ì´ë¦„ : " + name); // ì‚¬ìš©ì ì´ë¦„ : Guest ê°€ ê²°ê³¼ê°’ì´ê² ë„¤ìš”.

    // 3. ê°’ì´ ì—†ì„ ë•Œì˜ ì˜ˆì™¸ ë°œìƒ
    String requriedName = maybeName.orElseThrow();  // ê°’ì´ ì—†ìœ¼ë©´ NoSuchElementException ë°œìƒ
  }
}
```

# ë¡œê·¸ì¸ì„ ìœ„í•œ AccountCredentialsë¥¼ Recordë¡œ ìƒì„±í–ˆìŠµë‹ˆë‹¤ ì´í›„ ê³¼ì •.
1. ë¡œê·¸ì¸ì„ ìœ„í•œ controller í´ë˜ìŠ¤ ìƒì„± í• ê²ë‹ˆë‹¤. `/login` ì—”ë“œí¬ì¸íŠ¸ë¥¼ POST ë©”ì„œë“œë¡œ í˜¸ì¶œí•˜ê³  ì‚¬ìš©ì ì´ë¦„ê³¼ ì•”í˜¸ë¥¼ ìš”ì²­ ë³¸ë¬¸ê³¼ í•¨ê»˜ ì „ì†¡í•˜ì—¬ ë¡œê·¸ì¸í• ê²ë‹ˆë‹¤(ê·¸ëŸ¬ë‹ˆê¹Œ Spring Securityì˜ defaultë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ì˜ë¯¸ê°€ ë˜ê² ë„¤ìš”).
  - web íŒ¨í‚¤ì§€ ë‚´ì— LoginController í´ë˜ìŠ¤ ìƒì„±.
  - ë¡œê·¸ì¸ ì„±ê³µ ì‹œì— JWTë¥¼ ìƒì„±í•˜ëŠ” ë° ì´ìš©ë  JwtService ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì— ì‚½ì…í•´ì•¼ í•©ë‹ˆë‹¤. ì´í•˜ëŠ” ê·¸ ê³¼ì •ì„ í’€ì–´ë‚¸ ì½”ë“œì…ë‹ˆë‹¤.
```java
package com.example.cardatabase.web;

import com.example.cardatabase.domain.AccountCredentials;
import com.example.cardatabase.service.JwtService;
import org.springframework.http.ResponseEntity;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class LoginController {
    // field ì„ ì–¸ -> final í‚¤ì›Œë“œ
    private final JwtService jwtService;
    private final AuthenticationManager authenticationManager;

    // ê·¸ë ‡ê¸° ë•Œë¬¸ì— í•„ìˆ˜ì ìœ¼ë¡œ AllArgsContructorë¡œ ìƒì„±í•´ì•¼ë§Œ í•˜ê³ 
    public LoginController(JwtService jwtService, AuthenticationManager authenticationManager) {
        this.jwtService = jwtService;
        this.authenticationManager = authenticationManager;
    }

    // POST ìš”ì²­ì„ ìœ„í•œ methodë¥¼ ì‘ì„± ì¤‘ì¸ë°
    // ì €í¬ê°€ fieldë¡œ ë°›ì•„ì˜¨ ë¶€ë¶„ì„ ì‚¬ìš©í•˜ì—¬ method í˜¸ì¶œì„ ì´ LoginControllerì˜ getToken()ë©”ì„œë“œ ë‚´ì—ì„œ í•˜ê² ì£ .
    @PostMapping("/login")
    public ResponseEntity<?> getToken(@RequestBody AccountCredentials credentials) {
        // ì—¬ê¸°ì— í† í° ìƒì„±í•˜ê³  ì‘ë‹µì˜ Authorization í—¤ë”ë¡œ ì „ì†¡í•´ì£¼ëŠ” ë¡œì§ ì‘ì„±í• ê²ë‹ˆë‹¤.
    }
}

```