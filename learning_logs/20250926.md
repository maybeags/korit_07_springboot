# ì…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ğŸ’Œ

# CORS Filter ì¶”ê°€í•˜ê¸°
- CORS(Cross-Origin Resources Sharing) : í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ êµì°¨ ì¶œì²˜ ì¬ìš”ì²­ì„ í—ˆìš©í• ì§€ ê±°ë¶€í• ì§€ë¥¼ ê²°ì •í•˜ê²Œ í•˜ëŠ” íŠ¹ì • í—¤ë”ë¥¼ ê°€ì§. 
- CORS filterëŠ” ë‹¤ë¥¸ ì¶œì²˜ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” í”„ë¡ íŠ¸ì—”ë“œì™€ì˜ í†µì‹ ì—ì„œ í•„ìš”í•©ë‹ˆë‹¤.
- í”„ë¡ íŠ¸ì—”ë“œ ìƒì—ì„œ íŠ¹ì • ìš”ì²­ì´ ë°±ì—”ë“œë¡œ ë„˜ì–´ê°€ê²Œ ë˜ëŠ” ê³¼ì •ì—ì„œ CORS í•„í„°ê°€ ìš”ì²­ì„ ì¤‘ê°„ì— í™•ì¸í•˜ì—¬, êµì°¨ ì¶œì²˜ë¡œ ì‹ë³„ë˜ë©´ ìš”ì²­ì— ì ì ˆí•œ í—¤ë”ë¥¼ ì¶”ê°€í•˜ì—¬ ì„œë¡œ í†µì‹ ì„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•´ì¤ë‹ˆë‹¤.
- CorsConfigurationSource ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- í˜„ì¬ê¹Œì§€ì˜ ì˜ˆì œì—ì„œëŠ” ëª¨ë“  ì¶œì²˜ì˜ HTTP ë©”ì„œë“œì™€ í—¤ë”ë¥¼ í—ˆìš©í•˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤.

1. SecurityConfig í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
ìˆ˜ì •ì „
```java
package com.example.cardatabase;

import com.example.cardatabase.service.UserDetailsServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@Configuration
@EnableWebSecurity
public class SecurityConfig {
    private final UserDetailsServiceImpl userDetailsService;
    private final AuthenticationFilter authenticationFilter;
    private final AuthEntryPoint exceptionHandler;

    public SecurityConfig(UserDetailsServiceImpl userDetailsService, AuthenticationFilter authenticationFilter, AuthEntryPoint exceptionHandler) {
        this.userDetailsService = userDetailsService;
        this.authenticationFilter = authenticationFilter;
        this.exceptionHandler = exceptionHandler;
    }

    public void configGlobal (AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(new BCryptPasswordEncoder());
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {
        return authConfig.getAuthenticationManager();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
                .sessionManagement(sessionManagement ->
                        sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(authorizeHttpRequests ->
                        authorizeHttpRequests.requestMatchers(HttpMethod.POST, "/login").permitAll().anyRequest().authenticated())
                .addFilterBefore(authenticationFilter, UsernamePasswordAuthenticationFilter.class)
                .exceptionHandling(exceptionHandling ->
                        exceptionHandling.authenticationEntryPoint(exceptionHandler));
        return http.build();
    }
}
```
cors ê´€ë ¨ ì¶”ê°€
```java
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.setAllowedOrigins(Arrays.asList("*"));
        config.setAllowedMethods(Arrays.asList("*"));
        config.setAllowedHeaders(Arrays.asList("*"));

        config.setAllowCredentials(false);
        config.applyPermitDefaultValues();

        source.registerCorsConfiguration("/**", config);
        return source;
    }
```
// íŠ¹ì • Originë§Œì„ ëª…ì‹œì ìœ¼ë¡œ ì •ì˜í•˜ë ¤ë©´
`config.setAllowOrigins(Arrays.asList("http://localhost:5173", "http://localhost:3000"))`
ê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ì°¨í”¼ 5173ì¼ê±°ë‹ˆê¹Œ í—·ê°ˆë¦¬ë©´ ctrl + fë¡œ 5173 ê²€ìƒ‰í•´ë‘ì„¸ìš”.
2. SecurityConfigë¥¼ ìˆ˜ì •í–ˆìœ¼ë‹ˆ filterChain ê´€ë ¨ methodë„ ìˆ˜ì •í•´ì•¼í•©ë‹ˆë‹¤.

```java
import static org.springframework.security.config.Customizer.withDefaults;


    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
                .cors(withDefaults())                     // ì—¬ê¸° ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ê·¼ë° static ë©”ì„œë“œ ì¶”ê°€í•˜ëŠ” importë¬¸ë„ ì¶”ê°€ë¨.
                .sessionManagement(sessionManagement ->
                        sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(authorizeHttpRequests ->
                        authorizeHttpRequests.requestMatchers(HttpMethod.POST, "/login").permitAll().anyRequest().authenticated())
                .addFilterBefore(authenticationFilter, UsernamePasswordAuthenticationFilter.class)
                .exceptionHandling(exceptionHandling ->
                        exceptionHandling.authenticationEntryPoint(exceptionHandler));
        return http.build();
    }
```

# Role-Based Protection
- Spring SecurityëŠ” ì—­í• ì„ ì´ìš©í•˜ì—¬ ì„¸ë¶„í™”ëœ ì—­í•  ê¸°ë°˜ ë³´ì•ˆì„ ì •ì˜í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš©ìëŠ” í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ì—­í• ì— í• ë‹¹ë˜ì–´ì§ˆ ìˆ˜ ìˆë‹¤. ì—­í• ì€ í”íˆ ADMIN / MANAGER / USERì™€ ê°™ì€ ê³„ì¸µ êµ¬ì¡°ë¥¼ ê°€ì§€ê²Œ ë˜ëŠ”ë° USERê°€ í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì¼ì€ MANAGERê°€ ë‹¤ í•  ìˆ˜ ìˆìœ¼ë©´ì„œ MANAGERëŠ” USERë³´ë‹¤ ë” ë§ì€ ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§€ê³ , ADMINì€ MANAGERê°€ í•  ìˆ˜ ìˆëŠ”ê±¸ ë˜ ë‹¤ í•  ìˆ˜ ìˆìœ¼ë©´ì„œ ì§€ë§Œ í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ì ‘ê·¼ ê¶Œí•œì„ ê°–ëŠ” ë“±ìœ¼ë¡œ ìƒê°í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.

SecurityConfig í´ë˜ìŠ¤ì˜ ìš”ì²­ ìˆ˜ì¤€ì—ì„œ ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´í•˜ì˜ ì˜ˆì œ ì½”ë“œì—ì„œëŠ” ì ‘ê·¼ì„ ìœ„í•œ íŠ¹ì • ì—­í• ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í• ê²ë‹ˆë‹¤. `/admin/**` ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ë ¤ë©´ ADMIN ì—­í• ì´ í•„ìš”í•˜ê³ , `/user/**` ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ë ¤ë©´ USER ì—­í• ì´ í•„ìš”í•œ ë“±ì´ ë˜ê² ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì§€ì •ëœ ì—­í• ì„ ê°€ì§€ê³  ìˆìœ¼ë©´ trueë¥¼ ë°˜í™˜í•˜ëŠ” Spring Security hasRole() ë©”ì„œë“œë¥¼ ì´ìš©í•©ë‹ˆë‹¤.


Role-Based Protection ì ìš© filterChain ì˜ˆì‹œ(ì˜ˆì œ í”„ë¡œì íŠ¸ì—ëŠ” ë„ì…í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)
```java
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
                .cors(withDefaults())
                .sessionManagement(sessionManagement ->
                        sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(authorizeHttpRequests ->
                  authorizeHttpRequests.requestMatchers("/admin/**").hasRole("ADMIN").requestMatchers("/user/**").hasRole("USER").anyRequest().authenticated())
                .addFilterBefore(authenticationFilter, UsernamePasswordAuthenticationFilter.class)
                .exceptionHandling(exceptionHandling ->
                        exceptionHandling.authenticationEntryPoint(exceptionHandler));
        return http.build();
    }
```

Spring SecurityëŠ” Method ìˆ˜ì¤€ì˜ ë³´ì•ˆì„ ì ìš©í•˜ëŠ” ë° ì´ìš©ë˜ëŠ” `@PreAuthorize, @PostAuthorize, @PreFilter, @PostFilter, @Secured` ì• ë„ˆí…Œì´ì…˜ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ë©”ì„œë“œ ìˆ˜ì¤€ ë³´ì•ˆì€ defaultë¡œ spring-boot-starter-securityì—ì„œ ì´ìš©í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ìŠ¤í”„ë§ êµ¬ì„± í´ë˜ìŠ¤(ìµœìƒìœ„-ì €í¬ ê¸°ì¤€ìœ¼ë¡œ CarDatabaseApplication)ì—ì„œ `@EnableMethodSecurity` ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ í™œì„±í™”í•´ì•¼í•˜ëŠ”ë°...
ì˜ˆì‹œë¡œ ë‚¨ê²¨ë‘ì§€ëŠ” ì•Šê² ìŠµë‹ˆë‹¤.

# BackEnd Tests
í˜„ì¬ê¹Œì§€ì˜ ì½”ë“œ ì‘ì„± íŒŒíŠ¸ë¥¼ ì „ë¶€ ê¹ƒí—ˆë¸Œì— ì˜¬ë ¤ë‘ê² ìŠµë‹ˆë‹¤.
git add .
git commit -m "feat: backend protection finished"
git push

cardatabase_3_test í”„ë¡œì íŠ¸ë¡œ ë³µì‚¬í•˜ê² ìŠµë‹ˆë‹¤.

## Tests In SpringBoot
Springboot test starter íŒ¨í‚¤ì§€ëŠ” í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•  ë•Œ Spring Initializrì— ì˜í•´ ìë™ìœ¼ë¡œ build.gradleì— ì¶”ê°€ë©ë‹ˆë‹¤.
```java
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
```
ìœ„ì— ì–©ë‹ˆë‹¤.
spring-boot-starter-testëŠ” JUnit / Mockito / AssertJ ê°™ì€ í…ŒìŠ¤íŠ¸ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. Mockito ëª¨ì˜ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¡œ JUnitê³¼ í•¨ê»˜ ìì£¼ ì´ìš©ë©ë‹ˆë‹¤. AssertJ Java í…ŒìŠ¤íŠ¸ì—ì„œ Assertionì„ ì‘ì„±í•˜ëŠ”ë° ì´ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” ì¸ë©”ëª¨ë¦¬ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì§€ê¸ˆ ì €í¬ëŠ” MariaDBë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸°ëŠ” í•œë°, testìš©ìœ¼ë¡œ ë‹¤ì‹œ h2 ì¸ë©”ëª¨ë¦¬ë¥¼ ì ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤.

```java
	testRuntimeOnly 'com.h2database:h2'
```
ì´ìƒê¹Œì§€ ì²˜ë¦¬í•˜ê³  ì½”ë¼ë¦¬ ëˆŒëŸ¬ì£¼ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìƒì„±
í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ ìœ í˜•ë“¤
1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test) : ì†Œí”„íŠ¸ì›¨ì–´ì˜ ê°€ì¥ ì‘ì€ ì»´í¬ë„ŒíŠ¸ì— ì´ˆì ì„ ë§ì¶˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í•¨ìˆ˜ì— ì´ˆì ì„ ë§ì¶˜ë‹¤ë©´, ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” í•¨ìˆ˜ê°€ ë…ë¦½ì ìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•œë‹¤. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ Mockingì€ í…ŒìŠ¤íŠ¸ ì¤‘ì¸ ë‹¨ìœ„ì˜ ì˜ì¡´ì„±ì„ ëŒ€ì²´í•˜ê¸° ìœ„í•´ í”íˆ ì‚¬ìš©ë˜ëŠ” ê°œë….

2. í†µí•© í…ŒìŠ¤íŠ¸(Integration Test) : ê°œë³„ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ìƒí˜¸ì‘ìš©ì— ì¤‘ì ì„ ë‘ì–´ ê°œë³„ ì»´í¬ë„ŒíŠ¸ê°€ ì˜ˆìƒëŒ€ë¡œ _í•¨ê»˜_ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸.

3. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸(Functional Test) : ê¸°ëŠ¥ ì‚¬ì–‘ì— ì •ì˜ëœ ë¹„ì§€ë‹ˆìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ì— ì¤‘ì ì„ ë‘”ë‹¤. í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì œì‹œëœ _ìš”êµ¬ ì‚¬í•­_ ì„ ì¶©ì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì„¤ê³„ë¨.

4. íšŒê·€ í…ŒìŠ¤íŠ¸(Regression Test) : ìƒˆë¡œìš´ ì½”ë“œ ë˜ëŠ” ì½”ë“œ ì—…ë°ì´íŠ¸ê°€ ê¸°ì¡´ ê¸°ëŠ¥ì„ ì†ìƒì‹œí‚¤ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•¨.

5. ì´ìš©ì„± í…ŒìŠ¤íŠ¸(Usability Test) : ìµœì¢… ì‚¬ìš©ìì˜ ê´€ì ì—ì„œ ì†ŒíŠ¸íŠ¸ì›¨ì–´ê°€ ì‚¬ìš©ì ì¹œí™”ì ì´ê³  ì§ê´€ì ì´ë©° ì´ìš©í•˜ê¸° ì‰¬ìš´ì§€ ê²€ì¦í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•¨. í”„ë¡ íŠ¸ì—”ë“œ ë° ì‚¬ìš©ìê²½í—˜(UX)ì— ë” ì¤‘ì ì„ ë‘ëŠ” í¸.

ì´í•˜ëŠ” SpringBoot Test í´ë˜ìŠ¤ì˜ ì˜ˆì‹œì— í•´ë‹¹í•©ë‹ˆë‹¤.

```java
@SpringBootTest
public class MyTestClass {

  @Test
  public void testMethod() {
    // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë¡œì§
  }
}
```
- `@SpringBootTest` ì• ë„ˆí…Œì´ì…˜ì€ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ë¶€íŠ¸ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ì¼ë°˜ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¡œ ì§€ì •í•˜ëŠ” ìš©ë„.

- `@Test` ì• ë„ˆí…Œì´ì…˜ì€ ë©”ì„œë“œê°€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¡œ ì‹¤í–‰ë˜ë„ë¡ JUnitì— ì§€ì •í•˜ëŠ” ìš©ë„.

- Mocking : í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ê°ì²´ê°€ ë‹¤ë¥¸ ê°ì²´ë‚˜ ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ì˜ì¡´í•˜ëŠ” ê²½ìš°ì— ì‹¤ì œë¡œ ë‹¤ë¥¸ ê°ì²´ ë° ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  ê°€ì§œ ê°ì²´(Mock Object)ë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•¨. Mockingì„ ì´ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ê°ì²´ì˜ ì‘ë™ì„ ë…ë¦½ì ìœ¼ë¡œ ê²€ì¦í•  ìˆ˜ ìˆìœ¼ë©°, ì™¸ë¶€ ì˜ì¡´ì„±ìœ¼ë¡œ ì¸í•œ í…ŒìŠ¤íŠ¸ì˜ ë¶ˆí™•ì‹¤ì„±ê³¼ ë³µì¡ì„±ì„ í•´ì†Œí•  ìˆ˜ ìˆìŒ.
```java
public void methodA() {
  //ì–´ì©Œê³  ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§
}

public String methodB() {
  String result = "";
  methodA();
  // ì–´ì©Œê³  ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§

  return result;
}
```

Assertionì€ ì½”ë“œ ë‹¨ìœ„ì—ì„œì˜ ì‹¤ì œ ì¶œë ¥ì´ ì˜ˆìƒ ì¶œë ¥ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ë° ì´ìš©í•˜ëŠ” êµ¬ë¬¸ìœ¼ë¡œ, spring-boot-starter-test ì•„í‹°íŒ©íŠ¸ì— ìë™ìœ¼ë¡œ í¬í•¨ë˜ëŠ” AssertJ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ êµ¬í˜„í•©ë‹ˆë‹¤.
assertThat() ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ”ë°, ì´ ë©”ì„œë“œ ë‚´ì— ê°ì²´ í˜¹ì€ ê°’ì„ ì „ë‹¬í–ˆì„ ë•Œ ì‹¤ì œ ì¶œë ¥ê°’ê³¼ ë¹„êµë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
assertThat()ì€ ìë£Œí˜•ì— ë”°ë¼ ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ë°, ì˜ˆì‹œëŠ” ì´í•˜ì™€ ê°™ìŠµë‹ˆë‹¤.
```java
// ë¬¸ìì—´ í™•ì¸
assertThat("Learn Spring Boot").startsWith("Learn");

// ê°ì²´ í™•ì¸
assertThat(myObject).isNotNull();

// ì •ìˆ˜ í™•ì¸
assertThat(myNumberVariable).isEqualTo(3);

// Boolean í™•ì¸
assertThat(myBooleanVariable).isTrue();
```

Controllerì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ê³  nullì´ ì•„ë‹Œì§€ í™•ì¸í•˜ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³¼ê²ë‹ˆë‹¤.
í˜„ì¬ CarDatabaseApplicationTests í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ ì´í•˜ì™€ ê°™ìŠµë‹ˆë‹¤.
```java
package com.example.cardatabase;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class CardatabaseApplicationTests {

	@Test
	void contextLoads() {
	}

}
```
í™•ì¸í•´ë³´ì‹œë©´ ë‚´ë¶€ì— contextLoadsë¼ëŠ” í…ŒìŠ¤íŠ¸ ë©”ì„œë“œê°€ í•˜ë‚˜ ìˆê³ , ì—¬ê¸°ì— í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•  ê²ë‹ˆë‹¤. Controllerì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ê³  ì£¼ì…ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í• ê²ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì£¼ì…ëœ ì¸ìŠ¤í„´ìŠ¤ê°€ nullì¸ì§€ ì•„ë‹Œì§€ì˜ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ assertThatì„ ë„ì…í•˜ê² ìŠµë‹ˆë‹¤.


## @Autowired

- ì •ì˜ 
  Spring Frameworkì—ì„œ _ì˜ì¡´ì„± ì£¼ì…(Dependency Injection, DI)_ ì„ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©í•˜ëŠ” _í•µì‹¬ ì• ë„ˆí…Œì´ì…˜_ ì…ë‹ˆë‹¤. ê°œë°œìê°€ ì§ì ‘ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ëŒ€ì‹  Spring Containerê°€ í•„ìš”í•œ ê°ì²´ë¥¼ ì°¾ì•„ ìë™ìœ¼ë¡œ ì—°ê²°(ì£¼ì…)í•´ì£¼ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤.

- íŠ¹ì§• ë° ì‘ë™ ë°©ì‹
  1. ì˜ì¡´ì„± ì£¼ì…(DI)
    - íŠ¹ì • í´ë˜ìŠ¤ê°€ í•„ìš”ë¡œ í•˜ëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤(ì˜ì¡´ì„±)ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì™¸ë¶€ì—ì„œ ì œê³µë°›ëŠ” ë””ìì¸ íŒ¨í„´ êµ¬í˜„ì²´. `@Autowired`ë¥¼ ì‚¬ìš©í•˜ë©´ Springì´ ì´ ì£¼ì… ê³¼ì •ì„ ì•Œì•„ì„œ ì²˜ë¦¬í•¨.
  2. ìë™ ì—°ê²°
    - Spring ì»¨í…Œì´ë„ˆëŠ” `@Autowired`ê°€ ë¶™ì€ field, ìƒì„±ì, ë©”ì„œë“œë¥¼ ë°œê²¬í•˜ë©´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ê´€ë¦¬í•˜ê³  ìˆëŠ” _ì ì ˆí•œ íƒ€ì…_ ì˜ Beanì„ ì°¾ì•„ ìë™ìœ¼ë¡œ ì—°ê²°í•´ì¤ë‹ˆë‹¤.
  3. íƒ€ì… ê¸°ë°˜ íƒìƒ‰
    - ê¸°ë³¸ì ìœ¼ë¡œ Springì€ ì£¼ì… ëŒ€ìƒì˜ _Type_ ì„ ê¸°ì¤€ìœ¼ë¡œ ì»¨í…Œì´ë„ˆì—ì„œ ì¼ì¹˜í•˜ëŠ” beanì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤. ë§Œì¼ ë™ì¼ íƒ€ì…ì˜ ë¹ˆì´ ì—¬ëŸ¬ ê°œ ë°œê²¬ë˜ë©´ `@Qualifier` ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë¹ˆì˜ _ì´ë¦„_ ìœ¼ë¡œ ëª…í™•í•˜ê²Œ ì§€ì •í•´ì•¼ í•¨.
  4. í•„ìˆ˜(Required) ì„¤ì • 
    - ê¸°ë³¸ì ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…ì€ í•„ìˆ˜(required = true)ì¸ë°, ë§Œì•½ ì£¼ì…í•  ë¹ˆì´ ì»¨í…Œì´ë„ˆì— ì—†ì„ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤(ì–´ì œ ì €í¬ê°€ `@Component` ì•ˆë‹¬ì•„ì„œ ì˜¤ë¥˜ ë‚¬ì—ˆìŠµë‹ˆë‹¤). required = false ì„¤ì •í•˜ë©´ ì£¼ì…í•  ë¹ˆì´ ì—†ì–´ë„ í—ˆìš©ë©ë‹ˆë‹¤.

- ì˜ì¡´ì„± ì£¼ì… ìœ„ì¹˜ (Injection Position)
  - `@Autowired` í´ë˜ìŠ¤ ë‚´ ì„¸ êµ°ë°ì— ìœ„ì¹˜ê°€ ê°€ëŠ¥í•˜ë©°, ìµœì‹  Springì—ì„œëŠ” ìƒì„±ì ì£¼ì…ì„ ê¶Œì¥í•¨(ìš°ë¦¬ê°€ ê³„ì† í•´ì™”ìŠµë‹ˆë‹¤).

  1. field ì£¼ì… - ê°€ì¥ ì§€ì–‘ë˜ëŠ” ë°©ì‹ : ê°„ë‹¨í•˜ê¸´ í•œë° ê°ì²´ì˜ ë¶ˆë³€ì„±ì„ ë³´ì¥í•˜ê¸° ì–´ë µê³  í…ŒìŠ¤íŠ¸ê°€ ë¶ˆí¸í•´ì„œ ë¹„ê¶Œì¥ë©ë‹ˆë‹¤.
```java
@Service
public class MyService {
  @Autowired
  private UserRepository userRepository;
  // ìƒì„±ì / ë©”ì„œë“œ ì–´ì©Œê³ ì €ì©Œê³ 
}
```
  2. Setter ë©”ì„œë“œ ì£¼ì…(Setter Injection) - ì„ íƒì  ì˜ì¡´ì„±ì„ ì£¼ì…í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©ë˜ë©°, ê°ì²´ ìƒì„± í›„ ì£¼ì…ì´ ì´ë£¨ì–´ì§.
```java
@Service
public class MyService {
  private UserRepository userRepository;

  @Autowired
  public void setUserRepository(UserRepository userRepository) {
    this.userRepository = userRepository;
  }
}
```
  3. ìƒì„±ì ì£¼ì…(Constructor Injection) - ê°€ì¥ ê¶Œì¥ë˜ëŠ” ë°©ì‹. ê°ì²´ì˜ ë¶ˆë³€ì„±ì„ ë³´ì¥í•˜ê³ , ëˆ„ë½ëœ ì˜ì¡´ì„±ì„ ëª…í™•í•˜ê²Œ ì•Œ ìˆ˜ ìˆì–´ ê°€ì¥ ì•ˆì „í•˜ê³  ê¶Œì¥ë¨. ê·¼ë° ì´ê²Œ ì €í¬ê°€ ìƒì„±ì ì£¼ì…í•  ë•Œ @Autowiredë¥¼ ì•ˆì“´ê²Œ Spring 4.3 ì´í›„ë¶€í„°ëŠ” í´ë˜ìŠ¤ ë‚´ì— _ìƒì„±ìê°€ í•˜ë‚˜ë§Œ_ ì¡´ì¬í•œë‹¤ë©´ `@Autowired`ë¥¼ ìƒëµí•´ë„ ìë™ìœ¼ë¡œ ì£¼ì…ë©ë‹ˆë‹¤.

```java
@RestController
public class LoginController {
  private final JwtService jwtService;      // finalì„ í†µí•œ ë¶ˆë³€ì„± ë³´ì¥ - ê·¸ë¦¬ê³  ìƒì„±ìê°•ì œ
  private final AuthenticationManager authenticationManager;

  public LoginController(JwtService jwtService, AuthenticationManager authenticationManager) {
    this.jwtService = jwtService;
    this.authenticationManager = authenticationManager;
  }
}
// ê·¼ë° ë¡¬ë³µê¹Œì§€ ì ìš©í•œë‹¤ë©´
@RestController
@RequiredArgsConstructor
public class LoginController {
  private final JwtService jwtService;      // finalì„ í†µí•œ ë¶ˆë³€ì„± ë³´ì¥ - ê·¸ë¦¬ê³  ìƒì„±ìê°•ì œ
  private final AuthenticationManager authenticationManager;
}
```
CarControllerê°€ í˜„ì¬ ìƒí™©ì—ì„œ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë˜ì–´ìˆëŠ”ì§€ì— ëŒ€í•œ ì—¬ë¶€.
ìŸ¤ê°€ CarDatabaseApplicationTests í´ë˜ìŠ¤ì—ì„œ `@Autowired`ë¡œ ëŒê³  ì˜¬ ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ê°„ë‹¨í•˜ê²ŒëŠ” `@SpringBootTest` ì• ë„ˆí…Œì´ì…˜ ë•Œë¬¸ì…ë‹ˆë‹¤.
í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ê¸°ì¡´ CarDatabaseApplicationì— ìˆëŠ” ì „ì²´ í™˜ê²½ì„ ë¡œë“œí•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì—, ê·¸ ì„¤ì •ì— ë§ì¶°ì„œ IoC ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ê±°ê¸°ì„œ ìƒì„±ëœ ëª¨ë“  ì»´í¬ë„ŒíŠ¸(Controller / Service / Repository ë“±)ë¥¼ full scaní•˜ì—¬ Bean ë“±ë¡ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.

ì´ìƒì„ ì´ìœ ë¡œ CarController í´ë˜ìŠ¤ì— ìˆëŠ” `@RestController`ê°€ ìˆë‹¤ë©´ `@SpringBootTest` ê°€ ì»¨í…Œì´ë„ˆë¥¼ ë¡œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ Beanìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.

ì´ì œ ê¸°ë³¸ì ì¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í•™ìŠµì„ ë§ˆì³¤ê¸° ë•Œë¬¸ì— OwnerRepositoryì— ëŒ€í•œ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì„œ CRUD(Create / Read / Update / Delete) ê´€ë ¨ ì‘ì—…ì„ í…ŒìŠ¤íŠ¸í•  ê²ë‹ˆë‹¤. ì´ í…ŒìŠ¤íŠ¸ëŠ” ë¦¬í¬ì§€í† ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì˜¬ë°”ë¥´ê²Œ ìƒí˜¸ì‘ìš©í•˜ëŠ”ì§€ë¥¼ ê²€ì¦í• ê±°ê³ , ì´ ê³¼ì •ì—ì„œ ê°œë°œìì˜ ì˜ˆìƒëŒ€ë¡œ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ë¶€ë¶„ì´ ë ê²ë‹ˆë‹¤.

1. root í…ŒìŠ¤íŠ¸ íŒ¨í‚¤ì§€ì—ì„œ OwnerRepositoryTestë¼ëŠ” ìƒˆ í´ë˜ìŠ¤ë¥¼ ìƒì„±í• ê²ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ê°€ JPA ì»´í¬ë„ŒíŠ¸ì— ì´ˆì ì„ ë§ì¶”ê²Œ ë  ê²½ìš°ì—ëŠ” `@SpringBootTest` ì• ë„ˆí…Œì´ì…˜ ëŒ€ì‹ ì— `@DataJPATest` ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–˜ë¥¼ ì“°ë©´ H2 ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ ìŠ¤í”„ë§ ë°ì´í„°ê°€ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œ ìë™ìœ¼ë¡œ êµ¬ì„±ë˜ê³ , SQL ë¡œê¹…(ì½˜ì†”ì— ì°íˆëŠ”ê±°ìš”)ë„ ì¼œì§‘ë‹ˆë‹¤.

```java
package com.example.cardatabase;

import com.example.cardatabase.domain.OwnerRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;

@DataJpaTest
class OwnerRepositoryTest {
    @Autowired
    private OwnerRepository ownerRepository;
}
```
ì´ìƒì˜ ì½”ë“œì—ì„œ field ì£¼ì… í˜•íƒœë¡œ `@Autowired`ê°€ ì ìš©ëœ ê²ƒë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ì œ DBì— ìƒˆ Owner ì¶”ê°€ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•  ì˜ˆì •ì¸ë°, ìë™ ìƒì„± ë§ê³  OwnerRepository ìƒì—ì„œ ì´ìš©í•  ì¿¼ë¦¬ ë©”ì„œë“œ ì¢€ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.
```java
Optional<Owner> findByFirstName(String firstName);
```

ì´ë²ˆì—ëŠ” DBì—ì„œ Owner í•˜ë‚˜ë¥¼ ì‚­ì œí• ê²ë‹ˆë‹¤. ê·¼ë° ìš°ë¦¬ê°€ H2ì¸ë©”ëª¨ë¦¬ì¸ ìƒí™©ì—ì„œ CardatabaseApplicationì— ì‘ì„±í•œ ë”ë¯¸ ë°ì´í„°ê°€ ì ìš©ëœë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ê¸° ë•Œë¬¸ì— ì¼ë‹¨ ìƒˆ Ownerí•˜ë‚˜ë¥¼ ì¶”ê°€í•´ì„œ ë„£ê³ , ê·¸ ë‹¤ìŒì— ì „ì²´ ëª©ë¡ì„ ë‹¤ ì‚­ì œí•˜ëŠ” ë¶€ë¶„ì„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

ì¤‘ìš”í•œ ë¶€ë¶„ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¼ì¸ì´ ì–´ë–¤ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì¡Œë‚˜ì…ë‹ˆë‹¤.
```java
@Test
@DisplayName("ì‚­ì œ í…ŒìŠ¤íŠ¸ : ")
void deleteOwners() {
  //ê·¸ëŸ¬ë©´ ì¼ë‹¨ ê°ì²´ ìƒì„±ì„ í•˜ë‚˜ í•´ì„œ repositoryì— ì €ì¥í• ê²ë‹ˆë‹¤.
  ownerRepository.save(new Owner("íŒ”ë°±", "ë°•"));
  // ì‚­ì œ method í˜¸ì¶œ
  ownerRepository.deleteAll();
  // ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ë¥¼ ì²´í¬í•˜ëŠ” assertThat()ë¬¸ì´ í•„ìˆ˜ì ìœ¼ë¡œ ìš”êµ¬ë©ë‹ˆë‹¤.
  assertThat(ownerRepository.count()).isEqualTo(0);
}
```

ë°¥ ë¨¹ê³  ë‚˜ì„œëŠ” ì œê°€ íŠ¹ì • ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ë¼ê³  í–ˆì„ ë•Œì˜ ë…¼ë¦¬ì  íë¦„ì„ ì—¬ëŸ¬ë¶„ë“¤ì´ ì‘ì„±í•˜ê²Œ ë ê²ë‹ˆë‹¤.

1. ë£¨íŠ¸ í…ŒìŠ¤íŠ¸ íŒ¨í‚¤ì§€ì—ì„œ CarRestTest í´ë˜ìŠ¤ë¥¼ ìƒì„±í• ê²ë‹ˆë‹¤. Controller ë˜ëŠ” ë…¸ì¶œëœ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„œëŠ” MockMvc ê°ì²´ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. MockMvc ê°ì²´ë¥¼ ì´ìš©í•˜ë©´ ì„œë²„ê°€ ì‹œì‘ë˜ì§€ëŠ” ì•Šì§€ë§Œ Spring ìì²´ì—ì„œ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê³„ì¸µì—ì„œ í…ŒìŠ¤íŠ¸ê°€ ìˆ˜í–‰ë˜ë¯€ë¡œ ì‹¤ì œì™€ ìœ ì‚¬í•˜ê²Œ ìƒí™©ì„ ì¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ MockMvc ë‚´ì—ëŠ” ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” Performance Methodsë¥¼ ì œê³µí•´ì¤ë‹ˆë‹¤. Authentication ê´€ë ¨ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë ¤ë©´ ìš”ì²­ ë³¸ë¬¸ì— ìê²© ì¦ëª…ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. .andDo() ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ ìš”ì²­ ë° ì‘ë‹µ ì„¸ë¶€ ì •ë³´ë¥¼ consoleì— ì¶œë ¥í•˜ê³ , .andExpect() ë©”ì„œë“œë¥¼ í™œìš©í•˜ì—¬ ì‘ë‹µ ìƒíƒœê°€ ì •ìƒìœ¼ë¡œ ë‚˜ì˜¤ëŠ”ì§€ ì²´í¬í• ê²ë‹ˆë‹¤.(assertThat()ì„ ì´ìš©í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ëŠ” ì ì—ì„œ í•¨ê»˜ ë³¼ê²ë‹ˆë‹¤) ì´í•˜ì˜ ì½”ë“œëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

```java
package com.example.cardatabase;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpHeaders;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@SpringBootTest
@AutoConfigureMockMvc
public class CarRestTest {
    @Autowired
    private MockMvc mockMvc;

    @Test
    @DisplayName("ìê²©ì¦ëª…ì¸ì¦í…ŒìŠ¤íŠ¸")
    public void testAuthentication() throws Exception {
        this.mockMvc.perform(post("/login")
                .content("{\"username\":\"admin\",\"password\":\"admin\"}")
                .header(HttpHeaders.CONTENT_TYPE,"application/json"))
                .andDo(print()).andExpect(status().isOk());
    }
}
```
ì‹ì‚¬ ì „ / í›„ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ê²½ìš° ì²« ë²ˆì§¸ëŠ” repository íŒŒíŠ¸ì´ê¸° ë•Œë¬¸ì— DBì— ë°ì´í„°ë¥¼ ì •í™•í•˜ê²Œ CRUD í•  ìˆ˜ ìˆëŠ”ê°€ê°€ ì´ˆì ì´ì—ˆìŠµë‹ˆë‹¤.
ë°˜ë©´ ë°©ê¸ˆ ì „ì— ì‘ì„±í•œ ë¶€ë¶„ì˜ ê²½ìš°ì—ëŠ” MockMvcë¥¼ ì´ìš©í•˜ì—¬ ì‹¤ì œë¡œ postman ê°™ì€ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ POST ìš”ì²­ì„ "/login"ìœ¼ë¡œ ë‚ ë ¤ë³´ì•˜ì„ ë•Œ ê²°ê³¼ê°€ ì •í™•í•˜ê²Œ ë‚˜ì˜¤ëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ë¶€ë¶„ì´ì—ˆìŠµë‹ˆë‹¤.

ê·¼ë° ì—¬ëŸ¬ë¶„ì´ ëª…ì‹¬í•˜ì…¨ìœ¼ë©´ í•˜ëŠ” ë¶€ë¶„ì—ëŠ” ì €í¬ê°€ ìµœì´ˆ basic auth í˜•íƒœë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•˜ë ¤ê³  í•  ë•Œë„ postman headers ë‚´ì— Content-Typeì„ application/jsonìœ¼ë¡œ ë™ì¼í•˜ê²Œ ê°€ì ¸ê°”ë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

```java
package com.example.cardatabase;

import com.example.cardatabase.domain.Car;
import com.example.cardatabase.domain.CarRepository;
import com.example.cardatabase.domain.Owner;
import com.example.cardatabase.domain.OwnerRepository;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import static org.assertj.core.api.Assertions.assertThat;


@DataJpaTest
public class CarRepositoryTest {
    @Autowired
    private CarRepository carRepository;
    @Autowired
    private OwnerRepository ownerRepository;

    @Test
    @DisplayName("ì°¨ëŸ‰ ì €ì¥ ë©”ì„œë“œ í…ŒìŠ¤íŠ¸")
    void saveCar() {
        // given - ì œë°˜ ì¤€ë¹„ ì‚¬í•­
        // Car Entityë¥¼ í™•ì¸í•´ë´¤ì„ ë•Œ fieldë¡œ Ownerë¥¼ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì—
        // ì–˜ë¶€í„° ë¨¼ì € ë§Œë“¤ê³  -> ownerRepositoryì— ì €ì¥
        Owner owner = new Owner("Gemini", "GPT");
        ownerRepository.save(owner);
        // ê·¸ë¦¬ê³  Car ê°ì²´ë¥¼ ë§Œë“¤ê²ë‹ˆë‹¤.
        Car car = new Car("Ford", "Mustang", "Red", "ABCEDF", 2021, 567890, owner);
        // when - í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        // ì €ì¥ì´ ëëŠ”ê°€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ ë¶€ë¶„
        carRepository.save(car);
        // then - ê·¸ ê²°ê³¼ê°€ ì–´ë– í• ì§€
        assertThat(carRepository.findById(car.getId())).isPresent();    // ì´ê±´ ê·¸ëƒ¥ ê²°ê³¼ê°’ì´ í•˜ë‚˜ì¼í…Œë‹ˆê¹Œ.

        assertThat(carRepository.findById(car.getId()).get().getBrand()).isEqualTo("Ford");
    }
}
```

## Unit Test ê´€ë ¨ ì˜ˆì œ ë¬¸ì œë“¤
1. Car ì •ë³´ ì‚­ì œ ë° í™•ì¸
CarRepositoryTestì—ì„œ CarRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ìë™ì°¨ ì •ë³´ë¥¼ ì‚­ì œí•œ í›„, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•´ë‹¹ ì •ë³´ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆëŠ”ì§€ë¥¼ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ì‹œì˜¤.
- ì§€ì‹œ ì‚¬í•­
  1. CarRepositoryTestì— ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë¥¼ ì¶”ê°€
  2. í…ŒìŠ¤íŠ¸ìš© ìë™ì°¨ ë°ì´í„°ë¥¼ í•˜ë‚˜ ì €ì¥í•©ë‹ˆë‹¤.
  3. deleteAll() í˜¹ì€ deleteById() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì‚­ì œ.
  4. count() / assertThat()ì„ í™œìš©í•˜ì—¬ carRepositoryì— ë‚¨ì•„ìˆëŠ” ë°ì´í„°ê°€ 0ì¸ì§€ í™•ì¸í•˜ì—¬ ì‚­ì œë¥¼ ê²€ì¦.
```java
    @Test
    @DisplayName("ìë™ì°¨ ì •ë³´ ì‚­ì œ ë©”ì„œë“œ í…ŒìŠ¤íŠ¸")
    void deleteCar() {
        // given -> Owner ê°ì²´ ìƒì„± / ì €ì¥ -> Car ê°ì²´ ìƒì„± / ì €ì¥
        Owner owner = new Owner("Gemini", "GPT");
        ownerRepository.save(owner);
        Car car = new Car("Ford", "Mustang", "Red", "ABCEDF", 2021, 567890, owner);
        carRepository.save(car);
        // when -> ì‚­ì œ
//        carRepository.deleteById(car.getId());
        carRepository.deleteAll();
        // then -> ì‚­ì œê°€ ì˜¬ë°”ë¡œ ë˜ì—ˆëŠ”ì§€ ê²€ì¦í•˜ëŠ” assertThat() êµ¬ë¬¸
//        assertThat(carRepository.count()).isEqualTo(3);
        assertThat(carRepository.count()).isEqualTo(0);
    }
```
2. íŠ¹ì • ë¸Œëœë“œ ìë™ì°¨ ì¡°íšŒ
- ë¬¸ì œ : CarRepositoryì— ì •ì˜ëœ ë©”ì„œë“œë“¤ì„ ì°¸ì¡°í•˜ì—¬ íŠ¹ì • ë¸Œëœë“œì˜ ìë™ì°¨ ì¡°íšŒê°€ ê°€ëŠ¥í•œì§€ ê²€ì¦í•˜ì‹œì˜¤.
- ì§€ì‹œ ì‚¬í•­
  1. CarRepositoryTestì— ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
  2. ì´ 3 ê°œ ì´ìƒì˜ ìë™ì°¨ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ì €ì¥í•©ë‹ˆë‹¤(ê° brandê°€ ë‘ ëŒ€ê¹Œì§€ëŠ” ê²¹ì¹  ìˆ˜ ìˆê²Œ).
  3. findByBrand("Ford")ì™€ ê°™ì´ íŠ¹ì • ë¸Œëœë“œë¥¼ ì¡°íšŒí–ˆì„ ë•Œ í•´ë‹¹ ë¸Œëœë“œì˜ ìë™ì°¨ë§Œ ë°˜í™˜ë˜ëŠ”ì§€ assertThat()ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
  4. return íƒ€ì…ì´ listë‹ˆê¹Œ listì˜ í¬ê¸°ì™€ ì²« ë²ˆì§¸ ìš”ì†Œì˜ ë¸Œëœë“œë¥¼ ê²€ì¦í•˜ì‹œì˜¤.
  5. test methodëª…ì€ findByBrandShouldReturnCar()

```java
@Test
    @DisplayName("ë¸Œëœë“œ ê²€ìƒ‰ ë©”ì„œë“œ í…ŒìŠ¤íŠ¸")
    void findByBrandShouldReturnCar() {
        // given - Owner í•˜ë‚˜ ìƒì„± ë° ì €ì¥ /  Car ê°ì²´ 3 ëŒ€ ìƒì„± ë° ì €ì¥
        Owner owner = new Owner("Gemini", "GPT");
        ownerRepository.save(owner);
        Car car = new Car("Ford", "Mustang", "Red", "ABCEDF", 2021, 567890, owner);
        carRepository.save(car);

        carRepository.save(new Car("Toyota", "Treno", "Black-White", "123456", 1986, 10000, owner));
        carRepository.save(new Car("Toyota", "GR86", "Blue", "987654", 2025, 123456, owner));
        // when - carRepository.findByBrand("ë¸Œëœë“œëª…") -> ê·¼ë° ì–˜ ê²°ê³¼ ìë£Œí˜•ì´ ë­ì˜€ë‚˜ìš”.
        //      listë¼ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°,
        List<Car> toyotas = carRepository.findByBrand("Toyota");
        // thenì—ì„œì˜ ê²€ì¦ì€ list ë‚´ë¶€ì˜ elementì˜ ìë£Œí˜•ì´ Car ê°ì²´ì¼í…Œë‹ˆê¹Œ,
        // ê·¸ ê°ì²´ì˜ getBrand()ì˜ ê²°ê³¼ê°’ì´ ìš°ë¦¬ê°€ findByBrand()ì˜ arugmentë¡œ ì“´ ê°’ê³¼ ë™ì¼í•œì§€ë¥¼ ì²´í¬í•  ìˆ˜ ìˆê² ë„¤ìš”.
//        assertThat(toyotas.get(0).getBrand()).isEqualTo("Toyota");
        // í˜¹ì€, í˜„ì¬ ì €í¬ê°€ Toyota ì°¨ëŸ‰ì„ ë‘ ëŒ€ ë§Œë“¤ì—ˆìœ¼ë‹ˆê¹Œ size()ì˜ ê²°ê³¼ê°’ì´ 2ê² ì£ .
        assertThat(toyotas.size()).isEqualTo(2);
    }
```
3. ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
- ë¬¸ì œ : AppUserRepositoryì˜ findByUsername ë©”ì„œë“œê°€ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì°¾ì•„ë‚´ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±.
- ì§€ì‹œ ì‚¬í•­
  1. AppRepositoryTest ìƒì„±
  2. AppUserRepositoryë¥¼ ì£¼ì… ë°›ì•„ì„œ AppUser ë°ì´í„°ë¥¼ ì €ì¥
  3. findByUsername("user1")ì„ í˜¸ì¶œí•˜ê³ , ê²°ê³¼ê°€ Optional íƒ€ì…ì´ê¸° ë•Œë¬¸ì— isPresent()ê°€ trueì¸ì§€ í™•ì¸.
  4. ë˜í•œ ì¡°íšŒëœ ì‚¬ìš©ìì˜ roleì´ USERì¸ì§€ë„ ê²€ì¦í•˜ì‹œì˜¤.

```java
package com.example.cardatabase;

import com.example.cardatabase.domain.AppUser;
import com.example.cardatabase.domain.AppUserRepository;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import static org.assertj.core.api.Assertions.assertThat;


import java.util.Optional;

@DataJpaTest
public class AppUserRepositoryTest {
    @Autowired
    private AppUserRepository appUserRepository;

    @Test
    @DisplayName("findByUsername ë©”ì„œë“œ ê²€ì¦")
    void findByUsernameShouldReturnAppUser() {
        // given -
        appUserRepository.save(new AppUser("user1", "user1", "USER"));
        // when -
        Optional<AppUser> foundUser = appUserRepository.findByUsername("user1");
        // then -
        assertThat(foundUser).isPresent();
        assertThat(foundUser.get().getRole()).isEqualTo("USER");
    }
}
```
4. CarControllerì˜ GET `/cars` ì—”ë“œí¬ì¸íŠ¸ì˜ ìƒíƒœ ì½”ë“œ í…ŒìŠ¤íŠ¸
- ë¬¸ì œ : CarControllerì˜ `/cars` ì—”ë“œí¬ì¸íŠ¸ì— GET ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ, HTTP ìƒíƒœ ì½”ë“œê°€ 200 OKìœ¼ë¡œ ì‘ë‹µí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
- ì§€ì‹œ ì‚¬í•­
  1. CarControllerTest í´ë˜ìŠ¤ ìƒì„±
  2. `@WebMvcTest(CarController.class)` ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì›¹ ë ˆì´ì–´ë§Œ í…ŒìŠ¤íŠ¸
  3. MockMvc ê°ì²´ë¥¼ `@Autowired`ë¡œ ì£¼ì… ë°›ì•„ fake HTTP ìš”ì²­ì„ ë³´ë‚´ë„ë¡ ì‘ì„±
  4. CarRepositoryëŠ” ì‹¤ì œ beanì´ ì•„ë‹Œ ìƒíƒœì— í•´ë‹¹í•˜ë¯€ë¡œ `@MockBean`ì„ í™œìš©
  5. `mockMvc.perform(get("/cars"))`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚´ê³ , `andExect(status().isOk())`ë¡œ ìƒíƒœ ì½”ë“œë¥¼ ê²€ì¦ 

```java
package com.example.cardatabase;

import com.example.cardatabase.domain.CarRepository;
import com.example.cardatabase.web.CarController;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.http.HttpHeaders;
import org.springframework.test.context.bean.override.mockito.MockitoBean;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@WebMvcTest(CarController.class)
public class CarControllerTest {
    @Autowired
    private MockMvc mockMvc;

    @MockitoBean
    private CarRepository carRepository;

    @Test
    @DisplayName("GET /cars ìš”ì²­ í…ŒìŠ¤íŠ¸ ê²€ì¦")
    void testGetCars() throws Exception {
        this.mockMvc.perform(get("/cars")).andExpect(status().isOk());
    }
}
```

ê¸ˆì¼ ììŠµ ê´€ë ¨
1. ìê²©ì¦ ê³µë¶€
2. ë³µìŠµ - backend protection / TDD test-driven development
3. ë‹¨í†¡ë°© ê°œì„¤(ìˆ˜ê°•ìƒìš©)
4. ê°œë°œ ë¸”ë¡œê·¸
5. 1ë§Œ ì‹œê°„ì˜ ë²•ì¹™
6. 9ì›” 30ì¼ ì‹œí—˜ ì˜ˆì • - ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ
  - ì‹œí—˜ ê´€ë ¨ ì•ˆë‚´ëŠ” 16:30ì´ê² ì§€ë§Œ ììŠµì€ ì—†ë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
ë‹¤ìŒì£¼ ìˆ˜ì—… ê´€ë ¨
1. ì›”ìš”ì¼ - Spring Data RESTë¥¼ ì ìš©í•˜ì§€ ì•Šê³  MVC íŒ¨í„´ìœ¼ë¡œ cardatabaseë¥¼ ë§Œë“¤ê²ë‹ˆë‹¤.

git add .
git commit -m "feat: 20250926 backend protection / TDD test-driven development"
git push
ìê²© ì¦ëª… ì‚­ì œ
ìë¦¬ ì •ë¦¬