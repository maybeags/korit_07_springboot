# 입실 체크 해주세요 !! 💌

# MVC Pattern
- 정의 : 애플리케이션의 구조를 모델, 뷰, 컨트롤러라는 세 부분으로 분리하여 개발하는 방식.

## MVC 패턴이란 무엇인가
사용자 인터페이스를 갖춘 애플리케이션을 구조화하는 소프트웨어 디자인 패턴.
이는 비지니스 로직(데이터 처리), 사용자 인터페이스(화면 표시), 그리고 이 둘을 연결하는 제어 로직을 명확하게 분리하는 것을 목표로 합니다.
- MVC의 구성 요소
  - Model
    - 역할 : 데이터와 비지니스 로직을 담당. 애플리케이션이 '무엇을'하는지에 대한 핵심적인 부분. 데이터의 저장, 처리, 조회, 변경 등의 작업을 수행하며, 사용자에게 보여줄 데이터 자체를 담고 있음.
    - SpringBoot 상에서의 형태 : Service 클래스, Repository(DAO) 클래스, 혹은 데이터 객체(DTO 또는 Entity) 등이 해당함.
  - View
    - 역할 : 사용자에게 _데이터를 시각적으로 보여주는 역할_ . 사용자의 입력(클릭, 폼 제출 등)을 받고, 그 결과를 화면에 렌더링함. '어떻게' 보여줄지를 담당(그러면 저희가 HTML / CSS 부분이 떠오르죠).
    - SpringBoot 상에서의 형태 : HTML / CSS / JS를 통해 구성된 페이지들이며, SpringBoot에서는 주로 Thymeleaf, JSP(Java Server Page) 등의 템플릿 엔진을 사용하거나, REST API의 경우에는 JSON/XML 등의 데이터 형식으로 응답합니다. 근데 우리는 React로 연결할겁니다.
- Controller
  - 역할 : 사용자의 요청을 받아 처리하고, Model과 View를 연결하는 중재자 역할. 사용자가 '무엇을 할지'에 대한 요청을 분석하고, Model에게 필요한 작업을 지시한 후, 결과를 바탕으로 적절한 View를 선택하여 사용자에게 응답.
  - SpringBoot 상에서의 형태 : `@Controller, @RestController` 애너테이션이 붙은 클래스. `@RequestMapping` 등의 애너테이션으로 특정 URL 요청을 처리하는 메서드를 정의.

## Sping MVC의 동작 원리(요청 처리 흐름)
SpringBoot는 내부적으로 Spring MVC 프레임워크를 사용하여 MVC 패턴을 구현. 모든 요청을 처리하는 중앙 집중식 프론트 컨트롤러(Front Controller) 방식이 핵심.

- DispatcherServlet(디스패처 서블릿) - Spring MVC의 Core
  - 웹 애플리케이션으로 들어오는 모든 HTTP 요청을 가장 먼저 받아서 처리하는 프론트 컨트롤러 역할. Spring Boot는 내장된 웹 서버(보통은 아파치 톰캣입니다)를 사용하며, 별도의 복잡한 설정 없이 DispatcherServlet이 자동 설정됩니다(Spring으로 개발하면 이 서버 설정도 개발자가 해야 합니다).

- 요청 처리의 단계
  - 사용자가 웹 브라우저에서 특정 URL을 입력하거나 버튼을 클릭할 때(HTTP 요청 발생)부터 화면에 결과가 표시될 때 까지의 과정을 상세 설명합니다.
  1. 요청 수신(Request Reception) : 사용자의 요청(예시 : `GET /users/1`)이 `DispatcherServlet`으로 전달.
  2. 핸들러 매핑(Handler Mapping) : 
    - `DispatcherServlet`은 `HanlderMapping`에게 요청 URL을 처리할 적절한 Controller를 찾아달라고 요청.
    - `HanlderMapping`은 주로 `@Controller` 클래스의 `@RequestMapping` 애너테이션을 확인해서 요청을 처리할 특정 메서드를 찾게 됨.
  3. Controller 실행 :
    - `DispatcherServlet`은 찾은 Controller의 메서드를 `HandlerAdapter`를 통해 실행.
    - Controller는 요청을 분석하여 (필요한 경우에) Service/Respository(Model) 계층에 데이터 처리(비지니스 로직)를 요청.
    - 예를 들어, 사용자 정보를 조회하는 요청이라면 Model 계층에서 데이터베이스로부터 해당 정보를 가져오게 되겠네요(그런데 비밀번호는 안보여주겠네요 - Entity의 field를 편집한 버전을 전달해주겠다고 볼 수 있습니다).
  4. ModelView 반환
    - Controller의 _처리 결과를 담은 Model 데이터와 View의 논리적 이름을 포함하는_ ModelAndView 객체(또는 View 이름만, 또는 Model데이터만)를 `DispatcherServlet`에게 return.
  5. View 이름 해석(View Resolution) :
    - `DispatcherServlet`은 `ViewResolver`에게 View의 논리적인 이름(예를 들어 "user-detail")을 전달하여 실제 렌더링을 담당할 View 객체를 찾도록 요청.
  6. View 렌더링 및 응답(View Rendering & Response) :
    - `DispatcherServlet`는 최종적으로 View 객체에게 Model 데이터를 전달하고 렌더링을 요청합니다.
    - View는 Model 데이터를 사용하여 최종적인 HTML 응답 페이지를 생성하고, 이 응답은 `DispatcherServlet`을 거쳐 사용자(브라우저)에게 전송됩니다.

    - 쉽게 설명하면 `GET users/1`이면 DB 상에서의 user_id가 1인 애의 데이터를 이용하여 HTML 문서를 만들고, 2라면 user_id가 2인 애의 데이터를 활용하여 HTML 문서를 만들어서 브라우저로 보여준다고 보시면 되겠습니다.

## SpringBoot 3.5.6에서의 MVC 특징 및 구현 예시
SpringBoot에서는 Spring MVC를 자동으로 처리해주기 때문에 개발자는 핵심 로직에만 집중할 수 있습니다(비지니스 로직만 신경쓰고 서버 설정 그런건 좀 안해도 된다 그런 뜻입니다). 3.xx.xx 버전은 Java 17을 기반으로 하고, 설정 간소화와 편의성이 더 늘었습니다.

- Controller 구현 예시
```java


@Controller   // 해당 클래스가 Controller임을 선언
public class UserController {
  private final UserService userService;  // Model 계층과의 상호작용을 위한 Service를 주입(Injection)

  // 생성자 주입
  public UserController(UserService userService) {
    this.userService = userService;
  }

  // GET 요청으로 /users/123
  @GetMapping("/users/{userId}")
  public String getUserDetail(@PathVariable Long userId, Model model) {
    // 1. Controller는 Model(Service)에 데이터 처리를 요청
    User user = userService.findUserById(userId);

    // 2. Controller는 Model 데이터를 View에 전달하기 위해 Model 객체를 담음
    model.addAttribute("user", user);
    model.addAttribute("pageTitle", "사용자 상세 정보");

    // 3. Controller는 View의 논리적 이름을 return
    // : (ViewResolver가 'user-detail'에 해당하는 템플릿을 찾음)
    return "user-detail";
  }
}
```
이상의 코드는 Thymeleaf를 활용하여 SpringBoot와 HTML 문서를 연결하는 방식으로 저희가 받은 교재 중에 하나인 SpringBoot로 백엔드 개발자되기 책에도 동일한 방식의 코드 구현을 하고 있습니다.

- Model(Service 계층) 구현 예시
  - Controller의 요청을 받아서 실제 비지니스 로직을 처리하는 영역입니다. - 저희가 Java의 제어문을 배운 이유가 여기 부분에 특히 많이 들어갑니다.
```java
@Service    // 해당 클래스가 Service(Model)임을 명시
public class UserService {
  private final UserRepository userRepository;

  public userService(UserRepository userRepository) {
    this.userRepository = userRepository;
  }

  public User findUserById(Long id) {
    // UserRepository에서 담겨있는 DB를 조회해서 Java에서 쓸 수 있도록 해야겠네요.
    User user = userRepository.findById(id);
    if(id == user.getId()) {
      return user;
    }
    return null;
  }
}
```
- 그 다음은 View 파트를 작성해야하는데, Thymeleaf로 쓰는 예시를 굳이 보여드릴 필요는 없을 것 같아서 그냥 지나가겠습니다. 저희는 React로 작성할겁니다. 혹시나 Thymeleaf 프레임워크의 예시가 궁금하시면 이상의 교재를 확인하시면 됩니다.

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">사용자 상세</title> 
</head>
<body>
    <h1>사용자 상세 정보</h1>
    
    <p>ID: <span th:text="${user.id}">123</span></p>
    <p>이름: <span th:text="${user.name}">김철수</span></p>
    <p>이메일: <span th:text="${user.email}">chulsoo@email.com</span></p>
    
    <a href="/">돌아가기</a>
</body>
</html>
```